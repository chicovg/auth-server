{% extends "client/base.html" %}
{% block content %}
  <div class="content">
      <h1 class="title">Welcome!</h1>
      <p>This is an example client to demo and test the auth-server functionality.</p>
      <div class="box">
          <p class="title">Authorization Code</p>
          <p>Demostrates the <a href="https://tools.ietf.org/html/rfc6749#section-4.1">Authorization Code</a> grant type.</p>
          <button id="authorization-code" class="button is-primary">Login</button>
      </div>
  </div>
{% endblock %}
{% block page-scripts %}
  <script type="text/javascript">
   (function() {
       var clientId = 'example-client';
       var authorizeEndpoint = 'http://localhost:3000/api/authorize';
       var redirectUri = 'http://localhost:4000/redirect';

       var authCodeButton = document.getElementById('authorization-code');
       var uri = authorizeEndpoint + '?response_type=code&client_id=' + clientId + "&redirect_uri=" + redirectUri;

       authCodeButton.addEventListener('click', function() {
           fetch(uri)
               .then(function(response) {
                   if (response.redirected) {
                       window.location = response.url;
                   } else {
                       throw Error('Something went wrong, there should have been a redirect');
                   }
               })
               .error(function(error) {
                   console.log(error);
               });
       });
   })();
  </script>
{% endblock %}
